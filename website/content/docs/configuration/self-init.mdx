---
sidebar_label: initialize
description: |-
  The initialize stanza allows request-based one-time initialization of OpenBao
  from the configuration file.
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


# Self-Initialization

Self-Initialization allows server operators to define initial
service state through request-driven initialization that occurs
automatically on first server start. Operators can reference environment
variables and files to provision initial authentication, audit, and secret
mounts in addition to having full control over general requests.
Instead of manually executing multiple API commands after starting the server, 
all necessary settings can be defined in advance.

:::info

All requests are subject to the same restrictions as if they were executed
normally: audit logging, authentication, and API variable restrictions (such as
unauthenticated rotation and audit device creation) still apply.

:::

# `initialize` stanza

The `initialize` stanza specifies various configurations for OpenBao to
initialize itself once, on initial startup. To repeat the operation, remove
all storage and re-initialize from scratch. Debugging can be performed by
starting OpenBao with the `TRACE` log level, which shows all request/response
pairs and thus **contains sensitive information**.

When self-initialization fails, it logs an error to the server; this allows
operators to debug partial failures and remediate as necessary. The intention
is to give operators enough facility to bootstrap a proper initialization
process without requiring one-time side-effecting setup like generating the
initial root token and handling recovery keys.

<Tabs groupId="config">
<TabItem value="JSON">

```json
{
  "initialize": [
    {
      "audit": {
        "request": [
          {
            "enable-audit": {
              "operation": "update",
              "path": "sys/audit/stdout",
              "data": {
                "type": "file",
                "options": {
                  "file_path": "/dev/stdout",
                  "log_raw": true
                }
              }
            }
          }
        ]
      }
    }
  ]
}
```

</TabItem>
<TabItem value="HCL">

```hcl
initialize "audit" {
  request "enable-audit" {
    operation = "update"
    path = "sys/audit/stdout"
    data = {
      type = "file"
      options = {
        file_path = "/dev/stdout"
        log_raw = true
      }
    }
  }
}
```

</TabItem>
</Tabs>

:::info

Use of this feature requires using an [auto-unseal](seal/index.mdx)
mechanism. No recovery keys are generated; instead, use the [authenticated
recovery key rotation](/api-docs/system/rotate) endpoints.

The root token is not returned to the caller and is revoked after use.

:::

## HA Cluster Considerations

When using the `initialize` stanza with [`retry_join`](storage/raft.mdx#retry_join-stanza)
in a Raft HA cluster, OpenBao will automatically wait for the `retry_join` process
to potentially succeed before attempting self-initialization. This coordination
is necessary because `retry_join` runs asynchronously in the background - without
waiting, a node might self-initialize and create a separate cluster instead of
joining an existing one.

By default, OpenBao waits up to 30 seconds for a potential cluster join. This can
be configured using the `OPENBAO_SELF_INIT_RETRY_JOIN_WAIT` environment variable:

```bash
# Wait up to 60 seconds for retry_join
export OPENBAO_SELF_INIT_RETRY_JOIN_WAIT=60s

# Disable the wait (not recommended in HA deployments)
export OPENBAO_SELF_INIT_RETRY_JOIN_WAIT=0s
```

:::warning

In multi-node deployments, ensure that only the intended leader node runs the
`initialize` stanza, or stagger the startup of nodes to allow the first node
to complete initialization before other nodes start.

:::

Multiple `initialize` stanzas may exist and are executed in the order they
are specified in the configuration file(s). Multiple `request` blocks may
exist inside a single `initialize` stanza and are executed in the order they
appear in the specified `initialize` block. No two blocks of either type may
share a name. Names must conform to the regex `^[A-Za-z_][A-Za-z0-9_-]*$`.

## `initialize` parameters

The `initialize` stanza can only contain one or more `request` stanzas. Each
`initialize` and `request` stanza must have a single name.

### `request` parameters

- `operation` `(value[string]: <required>)` - type of operation to perform; see
  [ACL Capabilities](../concepts/policies.mdx#capabilities) for a list.
- `path` `(value[string]: <required>)` - path to perform the given operation
  on.
- `token` `(value[string]: <optional>)` - the OpenBao API token to use for
  authentication. When not specified, defaults to the root token.
- `data` `(value[map]: <optional>)` - the request data for this call.
- `allow_failure` `(value[bool]: false)` - when true, allows this call to fail
  without erring out the entire self-initialization process.
  
## Profiles

For more information on profiles, see the [concepts page](../concepts/profiles.mdx).
